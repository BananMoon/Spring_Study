# 스프링을 이용한 트랜잭션 문제 해결 - 트랜잭션 템플릿
V3은 모든 서비스에서 트랜잭션을 시작하려면 try&catch&finally(bc.예외 처리)와 트랜잭션 성공/실패 시 commit/rollback 로직을 반복 작성해야하는 문제가 있다.

이런 형태는 모든 서비스에서 반복되고 비즈니스 로직만이 달라지게 된다.<br>
스프링은 `TransactionTemplate`이라는 기능을 제공하여 중복 문제를 해결하는데<br>
트랜잭션 템플릿은 '템플릿 콜백 패턴'을 활용하여 구현되어 있다. (패턴은 추후 알아볼 예정)


## 트랜잭션 템플릿
'템플릿 콜백 패턴'을 적용하려면 템플릿을 제공하는 클래스를 만들어야하는데, 스프링은 `TransactionTemplate`이라는 템플릿 클래스를 제공한다.<br>
해당 클래스 내부에 트랜잭션 관련 로직이 들어가있기 때문에 반복되는 트랜잭션 관련 로직은 제외하고 우리는 비즈니스 로직만 구현하면 된다.


서비스 메서드 V3_2 : 트랜잭션 템플릿 클래스를 이용해서 중복 코드를 제거하여 서비스단의 V3_1을 개선해보자. ([참고 코드](https://github.com/BananMoon/Spring_Study/blob/main/Spring-DB/jdbc/src/main/java/springdb1/jdbc/service/MemberServiceV3_2.java))
- 비즈니스 로직이 정상 수행되면 커밋 (checked 예외 발생 시에도 커밋)
- unchecked 예외 발생 시 롤백
- 람다에서는 checked 예외를 밖으로 던지지 못해서 unchecked 예외로 던지도록 전환했다.


## 정리
- 덕분에 비즈니스 로직 외의 트랜잭션 시작&커밋/롤백 로직은 많이 제거됐다.
- 여전히 문제는 존재한다. **서비스 단에서 트랜잭션을 처리하는 로직이 여전히 포함되어있다는 것**이다.
- 애플리케이션을 구성하는 로직은 핵심 기능과 부가 기능으로 구분하면, 핵심 기능은 비즈니스 로직&부가 기능은 트랜잭션 로직이다.
- 즉, 부가 기능을 수정할 때 핵심 기능을 수정해야하는 것은 유지보수하기 어려운 코드라는 점이다.
